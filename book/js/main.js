for(var sommaire_book=[{titre:"FAISONS CONNAISSANCE !",start:1,end:11},{titre:"GAI, GAI L’ÉCOLIER",start:12,end:17},{titre:"MA FAMILLE ET ... MOI",start:18,end:22},{titre:"UN TOIT AU-DESSUS DE LA TÊTE",start:23,end:28},{titre:"VEUX-TU JOUER AVEC MOI ?",start:29,end:33},{titre:"SOYONS PROPRES !",start:34,end:39},{titre:"À TABLE !",start:40,end:44},{titre:"ALLÔ, DOCTEUR !",start:45,end:50},{titre:"LA SEMAINE DES DUPRÉ",start:51,end:68},{titre:"LA CAMPAGNE QUEL PLAISIR !",start:69,end:86},{titre:"POUSSE, POUSSE TON CHARIOT",start:87,end:104},{titre:"BONNE FÊTE !",start:105,end:122},{titre:"VEUX-TU M’AIDER ?",start:123,end:138},{titre:"VIVE LES VACANCES.",start:139,end:155},{titre:"UN CONTE POUR RÊVER.",start:156,end:160}],liste_module_book="",bi=0;bi<sommaire_book.length;bi++)liste_module_book+='<option value="'+sommaire_book[bi].titre+'" start="'+sommaire_book[bi].start+'"  end="'+sommaire_book[bi].end+'" >'+sommaire_book[bi].titre+"</option>";$("#liste_module_book").html(liste_module_book),$("#liste_module_book").multiselect({columns:1,placeholder:"Tous les modules",search:!0}),$("#liste_type_enrichi").multiselect({columns:1,placeholder:"Tous les types",search:!0});for(var data_fonts_tetxt=[],it=0;it<data_text.length;it++)for(var data_fontsfonts=JSON.parse(data_text[it])[0].fonts,ifon=0;ifon<data_fontsfonts.length;ifon++)data_fontsfonts[ifon],data_fonts_tetxt.push({color:data_fontsfonts[ifon].color,family:data_fontsfonts[ifon].family,fontspec:data_fontsfonts[ifon].fontspec,size:data_fontsfonts[ifon].size});var pdf_page_height=JSON.parse(data_text[0])[0].height,pdf_page_width=JSON.parse(data_text[0])[0].width,book_settings={pages:161,width:pdf_page_width,height:pdf_page_height};function getContetpage12(t){for(var e=[{mot:"\nle petit ",ind:"t0",start:"0",end:"0.5972834429824556",x:"47.960339943342774%",y:"22.0563025210084%"},{mot:" benoÃ®t ",ind:"t1",start:"0.6247063048245618",end:"1.1258810855263137",x:"59.57507082152974%",y:"22.21638655462185%"},{mot:"\n\nle petit ",ind:"t2",start:"2.7116740131578925",end:"3.244885014619879",x:"38.61189801699717%",y:"25.735294117647058%"},{mot:" benoÃ®t ",ind:"t3",start:"3.244885014619879",end:"3.7460597953216337",x:"47.39376770538244%",y:"26.10546218487395%"},{mot:"\ncompte ",ind:"t4",start:"4.082440113304091",end:"4.359361348684206",x:"38.328611898017%",y:"29.209663865546222%"},{mot:" jusquâ€™Ã  ",ind:"t5",start:"4.359361348684206",end:"4.812481798245608",x:"48.81019830028329%",y:"28.739495798319332%"},{mot:" trois.",ind:"t6",start:"4.812481798245608",end:"5.185511695906427",x:"58.44192634560906%",y:"29.317226890756306%"},{mot:"\nla petite ",ind:"t7",start:"5.922344773391807",end:"6.487591995614007",x:"38.328611898017%",y:"33.6764705882353%"},{mot:" alice ",ind:"t8",start:"6.487591995614007",end:"7.0208029970759975",x:"48.52691218130312%",y:"33.20903361344538%"},{mot:"\ncompte ",ind:"t9",start:"7.036821107456114",end:"7.68215888157892",x:"37.762039660056665%",y:"35.890126050420164%"},{mot:" jusquâ€™Ã  ",ind:"t10",start:"7.68215888157892",end:"8.071206889619859",x:"48.52691218130312%",y:"36.260504201680675%"},{mot:" six.",ind:"t11",start:"8.071206889619859",end:"8.556363559941495",x:"58.1586402266289%",y:"36.20798319327731%"},{mot:"\nmon ",ind:"t12",start:"8.556363559941495",end:"9.714280866228046",x:"36.342209631728046%",y:"39.93970588235294%"},{mot:" frÃ¨re ",ind:"t13",start:"9.714280866228046",end:"10.087310763888865",x:"43.42776203966006%",y:"40.09978991596638%"},{mot:" vincent ",ind:"t14",start:"10.087310763888865",end:"10.732648538011672",x:"52.492917847025495%",y:"40.04726890756302%"},{mot:"\ncompte ",ind:"t15",start:"10.732648538011672",end:"11.458076864035062",x:"37.47875354107649%",y:"42.94117647058823%"},{mot:" jusquâ€™Ã  ",ind:"t16",start:"11.458076864035062",end:"12.01282931093648",x:"48.52691218130312%",y:"43.51890756302521%"},{mot:" cent. ",ind:"t17",start:"12.01282931093648",end:"12.481967870878",x:"59.008498583569406%",y:"43.25903361344538%"},{mot:"\nmon ",ind:"t18",start:"12.481967870878",end:"13.864138722486185",x:"36.06232294617564%",y:"47.200630252100844%"},{mot:" cousin ",ind:"t19",start:"13.864138722486185",end:"14.335607699888792",x:"44.277620396600575%",y:"47.3609243697479%"},{mot:" Ã©mile ",ind:"t21",start:"18.260438646350664",end:"14.73041577176096",x:"53.05949008498584%",y:"47.25840336134454%"},{mot:"\ncompte ",ind:"t22",start:"15.117237619982552",end:"15.488087041884814",x:"37.47875354107649%",y:"49.726890756302524%"},{mot:" jusquâ€™Ã  ",ind:"t23",start:"15.504021287812678",end:"15.82706797193135",x:"49.093484419263454%",y:"50.09978991596638%"},{mot:" mille.\n",ind:"t24",start:"15.818344440808616",end:"17.95789516070391",x:"59.57507082152974%",y:"50.260084033613445%"}],n="",i=0;i<e.length;i++)n+='<img id="Mot_'+parseInt(100*e[i].start)+'"class="mydraghand" ind=\'t'+i+"' start='"+e[i].start+"' end='"+e[i].end+"' title=\""+e[i].mot+'" \n  style="display:none;position: absolute; \n    top: '+e[i].y+";\n    left: "+e[i].x+';\n    width: 20px;\n    height: auto;" src="icons/hand.png"  draggable="false" width="76px" height="auto" class="" alt="">\n  ';return'\n \n<div onclick="playmusic ( )" class="play playprev"\n style="background: white;\n    zoom: 2;\n    margin-left: calc(50% - 24px);\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    box-shadow: rgb(0 0 0 / 20%) 0px 3px 5px -1px, rgb(0 0 0 / 14%) 0px 6px 10px 0px, rgb(0 0 0 / 12%) 0px 1px 18px 0px;\n    position: absolute;\n    top: 17.5%;\n    left: -6%;\n    zoom: 1;cursor: pointer;">\n   <svg xmlns="http://www.w3.org/2000/svg" height="24px" \n   viewBox="0 0 24 24" width="24px" \n   fill="#446cb3"><path d="M0 0h24v24H0V0z" \n   fill="none"></path>\n   <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\n\n  </div>\n\n\n<button onClick="" style="position:absolute;top:10%;left:10%;    position: absolute;\n    top: 25%;\n    left: 13%;display:none;">Play</button> \n<audio id="audio" controls style="display:none;">\n   <source src="audio/p12.mp3" type="audio/mpeg" ontimeupdate=\'updateTrackTime(this);\'>\n</audio>\n\n<div> \n'+n+'\n</div>  \n<style>\n.kok-spot{\ndisplay:block;\n}\n.speak-text:hover{\nborder-bottom:5px solid yellow;\ncursor:default;\n}\n</style>\n<script>\n\n\n\n/**/\n\n\nfunction pusemusic ( ) {\n\nvar audio = document.getElementById("audio");\naudio.pause();\n  $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" height="24px"  viewBox="0 0 24 24" width="24px"  fill="#446cb3"><path d="M0 0h24v24H0V0z" fill="none"></path> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\');\n    //$(".mydraghand").hide();\n$(".playprev").attr("onClick",\'playmusic()\');\n\n}\nfunction playmusic ( ) {\n\n  \n $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#446cb3"><g><rect fill="none" height="24" width="24"/></g><g><g><path d="M9,16h2V8H9V16z M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8 s3.59-8,8-8s8,3.59,8,8S16.41,20,12,20z M13,16h2V8h-2V16z"/></g></g></svg>\');\n$(".playprev").attr("onClick",\'pusemusic()\');\n\n\nvar audio = document.getElementById("audio");\naudio.play();\n\n \n\n$(audio).on("ended", function  (argument) {\n   clearInterval(myInterval);\n    $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" height="24px"  viewBox="0 0 24 24" width="24px"  fill="#446cb3"><path d="M0 0h24v24H0V0z" fill="none"></path> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\');\n    $(".mydraghand").hide();\n\n});// ended...\n\n    $(".mydraghand").hide();\n  time = 0;\n\n   var myInterval = setInterval(function () {\n \n      time = Math.floor(audio.currentTime * 100);\n      console.log(audio.length)\n      var thismot = $("#Mot_"+time);\n      if( thismot ){\n        thismot.prevAll().hide();\n        thismot.show();\n      }\n      thismot.show(); \n  }, 1)\n\n\n}// playaudio...\n\n \n<\/script> \n'}function getContetpage7(t){for(var e=[{mot:"une",ind:"t0",start:"0",end:"0.29514676781002624",x:"29.525065963060687%",y:"29.019607843137255%"},{mot:" petite",ind:"t1",start:"0.3155662104221637",end:"0.5806590534300786",x:"39.55145118733509%",y:"29.03921568627451%"},{mot:" automobile",ind:"t2",start:"0.6858477902374663",end:"1.356668618073878",x:"57.229551451187334%",y:"28.666666666666664%"},{mot:" une",ind:"t3",start:"2.5287716853561997",end:"2.838945415567288",x:"33.74327176781003%",y:"33.98039215686274%"},{mot:" petite",ind:"t4",start:"2.838945415567288",end:"3.224253957783646",x:"40.07915567282322%",y:"34%"},{mot:" automobile",ind:"t5",start:"3.224253957783646",end:"4.135506184036945",x:"52.74406332453826%",y:"34.21568627450981%"},{mot:"\nqui",ind:"t6",start:"4.135506184036945",end:"4.535841688654358",x:"32.95514511873351%",y:"38.549019607843135%"},{mot:" courait",ind:"t7",start:"4.535841688654358",end:"4.8760693436675515",x:"41.6622691292876%",y:"38.37019607843137%"},{mot:" de",ind:"t8",start:"4.8760693436675515",end:"5.111108261873356",x:"48.522427440633244%",y:"38.19607843137255%"},{mot:" ville",ind:"t9",start:"5.111108261873356",end:"5.286039330474938",x:"54.32717678100264%",y:"38.411764705882355%"},{mot:" en",ind:"t10",start:"5.286039330474938",end:"5.460970399076522",x:"60.3957783641161%",y:"38.627450980392155%"},{mot:" ville",ind:"t11",start:"5.460970399076522",end:"5.906386790897102",x:"65.66939313984169%",y:"38.64705882352941%"},{mot:" ou",ind:"t12",start:"5.936440715699212",end:"6.291695333113461",x:"32.95514511873351%",y:"42.588235294117645%"},{mot:" va-t-elle?",ind:"t13",start:"6.36917799075801",end:"6.859675269781754",x:"40.60686015831135%",y:"42.411764705882355%"},{mot:" a parid,",ind:"t14",start:"7.145187555401807",end:"7.921197120045608",x:"36.912928759894456%",y:"46.549019607843135%"},{mot:"a paris.",ind:"t15",start:"8.326925104874103",end:"9.238177331127401",x:"50.105540897097626%",y:"46.568627450980394%"}],n="",i=0;i<e.length;i++)n+='<img id="Mot_'+parseInt(100*e[i].start)+'"class="mydraghand" ind=\'t'+i+"' start='"+e[i].start+"' end='"+e[i].end+"' title=\""+e[i].mot+'" \n  style="display:none;position: absolute; \n    top: '+e[i].y+";\n    left: "+e[i].x+';\n    width: 20px;\n    height: auto;" src="icons/hand.png"  draggable="false" width="76px" height="auto" class="" alt="">\n  ';return'\n \n<div onclick="playmusic ( )" class="play playprev"\n style="background: white;\n    zoom: 2;\n    margin-left: calc(50% - 24px);\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    box-shadow: rgb(0 0 0 / 20%) 0px 3px 5px -1px, rgb(0 0 0 / 14%) 0px 6px 10px 0px, rgb(0 0 0 / 12%) 0px 1px 18px 0px;\n    position: absolute;\n    top: 24.7%;\n    left: -23%;\n    zoom: 1;cursor: pointer;">\n   <svg xmlns="http://www.w3.org/2000/svg" height="24px" \n   viewBox="0 0 24 24" width="24px" \n   fill="#446cb3"><path d="M0 0h24v24H0V0z" \n   fill="none"></path>\n   <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\n\n  </div>\n\n\n<button onClick="" style="position:absolute;top:10%;left:10%;    position: absolute;\n    top: 25%;\n    left: 13%;display:none;">Play</button> \n<audio id="audio" controls style="display:none;">\n   <source src="audio/p7.mp3" type="audio/mpeg" ontimeupdate=\'updateTrackTime(this);\'>\n</audio>\n\n<div> \n'+n+'\n</div>  \n<style>\n.kok-spot{\ndisplay:block;\n}\n.speak-text:hover{\nborder-bottom:5px solid yellow;\ncursor:default;\n}\n</style>\n<script>\n\n\n\n/**/\n\n\nfunction pusemusic ( ) {\n\nvar audio = document.getElementById("audio");\naudio.pause();\n  $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" height="24px"  viewBox="0 0 24 24" width="24px"  fill="#446cb3"><path d="M0 0h24v24H0V0z" fill="none"></path> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\');\n    //$(".mydraghand").hide();\n$(".playprev").attr("onClick",\'playmusic()\');\n\n}\nfunction playmusic ( ) {\n\n  \n $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#000"><g><rect fill="none" height="24" width="24"/></g><g><g><path d="M9,16h2V8H9V16z M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8 s3.59-8,8-8s8,3.59,8,8S16.41,20,12,20z M13,16h2V8h-2V16z"/></g></g></svg>\');\n$(".playprev").attr("onClick",\'pusemusic()\');\n\n\nvar audio = document.getElementById("audio");\naudio.play();\n\n \n\n$(audio).on("ended", function  (argument) {\n   clearInterval(myInterval);\n    $(".playprev").html(\'<svg xmlns="http://www.w3.org/2000/svg" height="24px"  viewBox="0 0 24 24" width="24px"  fill="#446cb3"><path d="M0 0h24v24H0V0z" fill="none"></path> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></svg>\');\n    $(".mydraghand").hide();\n\n});// ended...\n\n    $(".mydraghand").hide();\n  time = 0;\n\n   var myInterval = setInterval(function () {\n \n      time = Math.floor(audio.currentTime * 100);\n      console.log(audio.length)\n      var thismot = $("#Mot_"+time);\n      if( thismot ){\n        thismot.prevAll().hide();\n        thismot.show();\n      }\n      thismot.show(); \n  }, 1)\n\n\n}// playaudio...\n\n \n<\/script> \n'}localStorage.clear();var __scale=1,old_scale=1;async function loadContent(t,e){var n="";7==t&&(n=getContetpage7());var i="";12==t&&(i=getContetpage12());var a='  \n <div class="layer-0 layer-book layer-text page-scale-factor2" style="\n    position:absolute;top:0;left:0;background:;\n    width:850px;height:1147px;">\n      \n    </div>\x3c!--End layer text--\x3e\n   <div class="layer-book page-draw" id="'+t+'" style="position:absolute;top:0;left:0;background:transparent;width:100%;height:100%;">\n       <svg  class="stage_draw_svg page-scale-factor" style="overflow: hidden;\n    position: absolute;\n    left: 0px;\n    top: 0;\n    background:;\n     width: 1334px;\n    height: 1800px;\n    transform-origin: 0 0;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"    viewBox="0 0 1334 1800" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></desc>  <defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"> <marker id="triangle_000" viewBox="0 0 10 10" refX="1" refY="5" markerUnits="strokeWidth" markerWidth="10" markerHeight="10" orient="auto"> <path d="M 0 0 L 10 5 L 0 10 z" fill="#000"/> </marker>  <marker id="triangle_2AA9C9" viewBox="0 0 10 10" refX="1" refY="5" markerUnits="strokeWidth" markerWidth="10" markerHeight="10" orient="auto"> <path d="M 0 0 L 10 5 L 0 10 z" fill="#2AA9C9"/> </marker> <marker id="triangle_18af0a" viewBox="0 0 10 10" refX="1" refY="5" markerUnits="strokeWidth" markerWidth="10" markerHeight="10" orient="auto"> <path d="M 0 0 L 10 5 L 0 10 z" fill="#18af0a"/> </marker> <marker id="triangle_fe0002" viewBox="0 0 10 10" refX="1" refY="5" markerUnits="strokeWidth" markerWidth="10" markerHeight="10" orient="auto"> <path d="M 0 0 L 10 5 L 0 10 z" fill="#fe0002"/> </marker>\n       </defs> \n       </svg>\n \n\n<div class=" layer-0 container-text-annotate">\n</div>\x3c!--End container-text-annotate--\x3e\n\n<div class="layer-0 container-elm-enrichi">\n'+n+"\n"+i+"\n "+await getContentLayerEnrichi(t)+"\n</div>\x3c!--End container-text-annotate--\x3e\n\n\n</div>\x3c!--End page draw--\x3e\n";localStorage.getItem("annotation-page-svg-"+t)&&(a=' <div class="page-draw" id="'+t+'" style="position:absolute;top:0;left:0;background:transparent;width:100%;height:100%;">\n               '+localStorage.getItem("annotation-page-svg-"+t)+"\n               </div>\x3c!--End page draw--\x3e"),e.find(".mypagecontent").append(a);$(".page-draw").width()}function getContentLayerEnrichi(t){return new Promise(async e=>{for(var n="",i=0;i<hosted_enrichi.length;i++)if(hosted_enrichi[i]&&hosted_enrichi[i].page==t){var a="#b4b4b4";hosted_enrichi[i].active&&(a="rgb(255, 102, 0)"),n+='\n<div  blank="'+hosted_enrichi[i].blank+'" w="'+hosted_enrichi[i].w+'" h="'+hosted_enrichi[i].h+'" top_="'+hosted_enrichi[i].top+'" left_="'+hosted_enrichi[i].left+'" page="'+hosted_enrichi[i].page+'" shared="'+hosted_enrichi[i].active+'" \nuniqueid="'+hosted_enrichi[i].id+'" id="'+hosted_enrichi[i].id+'" \nstyle="top:'+hosted_enrichi[i].top+"%;left:"+hosted_enrichi[i].left+"%;background:"+a+';position:absolute;" \nclass="anchor anchor-'+hosted_enrichi[i].type+'"\n title="'+unescape(atob(hosted_enrichi[i].titre))+'" url="'+hosted_enrichi[i].data+'"></div>'}e(n)})}async function getContentLayerAnnotate(t){return new Promise(async e=>{for(var n="",i=await localforagekKeys(),a=0;a<i.length;a++){if(i[a].includes("elm-annotate-audio_FR3_"+t)){var o=await localforageGetItem(i[a]);n+='<div key="'+i[a]+'" id="'+o.id+'" style="top:'+o.top+"%;left:"+o.left+'%;background:rgb(255, 102, 0);\n    position:absolute;" class="anchor anchor-audio-annotate  " title="" \n    url=""></div>'}if(i[a].includes("elm-annotate-note_FR3_"+t)){o=await localforageGetItem(i[a]);n+='<div key="'+i[a]+'" id="'+o.id+'" style="top:'+o.top+"%;left:"+o.left+'%;background:rgb(255, 102, 0);\n    position:absolute;" class="anchor anchor-note-annotate  " title="" \n    url=""></div>'}}e(n)})}function localforagekKeys(){return new Promise(async t=>{localforage.keys().then(function(e){t(e)}).catch(function(e){t(e)})})}function getContentLayerText(t){for(var e="",n=JSON.parse(data_text[t-1]),i=n[0].text,a=0;a<i.length;a++){var o=i[a].font;o=data_fonts_tetxt[o];i[a].width,n[0].width;var s=128*parseInt(i[a].top)/94,r=314*parseInt(i[a].left)/196;s/=__scale,r/=__scale,s=parseInt(i[a].top),r=parseInt(i[a].left),e+='\n  <div class="text speak-text" style=" transform: translate(2px, -15px);\n  position:absolute;font-family:\''+o.family+"';\n  font-size:"+(parseInt(o.size)+4.4)+"px;\n  top:"+s+"px;\n  left:"+r+'px;\n  opacity:0;\n  ">'+i[a].data+" </div>\n  "}return e}function encode_utf8(t){return unescape(encodeURIComponent(t))}function utf8Decode(t){if("string"!=typeof t)throw new TypeError("parameter ‘utf8String’ is not a string");return t.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(t){var e=(15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2);return String.fromCharCode(e)}).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(t){var e=(31&t.charCodeAt(0))<<6|63&t.charCodeAt(1);return String.fromCharCode(e)})}setInterval(function(){var t=$(".mypagecontent").parent().width()/1334;if(old_scale!=t){old_scale=t;var e=.6955*t/.443028;$("#scale_page").html("\n\n\n.page-scale-factor{\n transform :  scale("+t+"); \n transform-origin: 0 0;\n}\n.page-scale-factor2{\n transform :  scale("+e+"); \n transform-origin: 0 0;\n}\n\n\n")}__scale=t},1e3),$(document).on("mouseup touchend",".page-draw",function(t){localStorage.setItem("annotation-page-svg-"+$(this).attr("id"),$(this).html())}),setInterval(function(){$(".page-draw").width()},300);var lastposX=0,lastposY=0;$(document).on("mousemove touchmove",".page-draw",function(t){});var utterance=new SpeechSynthesisUtterance,SpeechRecogntion=window.webkitSpeechRecognition,recognition=new window.SpeechRecogntion,content="";recognition.continuous=!0,recognition.onstart=function(){},recognition.onspeechend=function(){},recognition.onerror=function(t){},recognition.onresult=function(t){},$(window).click(function(){$(".app-ressources").removeClass("is-active"),$("#mesressources").hide(),$(".thumbnails").hide()}),$(document).on("click",".app-ressources,#mesressources",function(t){t.stopPropagation()}),$(document).on("click",".thumbnails,#btn-header-thumbnails",function(t){t.stopPropagation()}),$(document).on("click",".header-btn",function(t){$(this).hasClass("app-ressources")}),$(document).on("change","#mesressources select",function(t){for(var e=[],n=[],i=0;i<160;i++)n.push(i);var a=$("#liste_module_book").val();a||(a=[],e=n);for(var o=0;o<a.length;o++)for(var s=0;s<sommaire_book.length;s++)if(sommaire_book[s].titre==a[o])for(var r=sommaire_book[s].start;r<=sommaire_book[s].end;r++)e.push(r);var l=$("#liste_type_enrichi").val();l||(l=["video","audio","yt","app","link-page","link"]);for(var d="",h=0;h<hosted_enrichi.length;h++)if(hosted_enrichi[h]){var c="#b4b4b4";hosted_enrichi[h].active&&(c="rgb(255, 102, 0)"),e.includes(parseFloat(hosted_enrichi[h].page))&&l.includes(hosted_enrichi[h].type)&&(d+='\n\t<div class="item-ressource ITMRSanchor-'+hosted_enrichi[h].type+' " blank="'+hosted_enrichi[h].blank+'" w="'+hosted_enrichi[h].w+'" \n\th="'+hosted_enrichi[h].h+'" top_="'+hosted_enrichi[h].top+'" \n\tleft_="'+hosted_enrichi[h].left+'" page="'+hosted_enrichi[h].page+'" \n\tshared="'+hosted_enrichi[h].active+'" \n\tuniqueid="'+hosted_enrichi[h].id+'" id="'+hosted_enrichi[h].id+'" \n\ttitle="'+unescape(atob(hosted_enrichi[h].titre))+'" url="'+hosted_enrichi[h].data+'"\n\t >\n\t\t<div class="item-activite-thumbnail">\n\t<div style="background:'+c+';z-index:0;" class="RSanchor RSanchor-'+hosted_enrichi[h].type+'" title="" url=""></div>\n\t    </div>\n\t<div class="item-activite-content">\n\t      <p class="title-activite">'+unescape(atob(hosted_enrichi[h].titre))+'</p>\n\t      <p class="description-activite" style="text-align: left;">\n\t      \t <span class="tag">page.'+hosted_enrichi[h].page+"</span>\n\t      </p>\n\t</div>\n\t</div>")}$("#itmes-ressources").html(d),$(".ms-options-wrap input").attr("placeholder","Chercher")}),$(document).on("click",".app-ressources",async function(t){($(this).toggleClass("is-active"),$(this).hasClass("is-active"))?(prepareRessources(await getUserInfo(),await listRowsDB()),$("#mesressources").show()):$("#mesressources").hide()}),$(document).on("click","#btn-book-text-select",function(t){$(this).toggleClass("is-active"),$(this).hasClass("is-active")?instance.pause():instance.resume()}),$(document).on("click","#btn-book-zoom-out",function(t){instance.smoothZoom($(".book").width()/2,$(".book").height()/2,.5)}),$(document).on("click","#btn-book-zoom-in",function(t){instance.smoothZoom($(".book").width()/2,$(".book").height()/2,1.5)}),$(document).on("keypress",".input-current-page",function(t){13===t.which&&$(".book").turn("page",$(this).val())}),$(document).on("click","#home-page",function(t){$(".book").turn("page",1)}),$(document).on("click","#sommaire-page",function(t){$(".book").turn("page",3)}),$(document).on("click","#prev-page",function(t){$(".book").turn("previous")}),$(document).on("click","#next-page",function(t){$(".book").turn("next")}),$(document).on("click","#btn-header-thumbnails",function(t){$(".thumbnails").toggle(),$("#btn-header-thumbnails").hasClass("is-active")?$("#btn-header-thumbnails").removeClass("is-active"):($("#btn-header-thumbnails").addClass("is-active"),$(".thumbnails").animate({scrollLeft:$(".thumbnails .item-thumbnails.active").offset().left},0))}),$(document).on("click",".close-thumbnails",function(t){$(".thumbnails").hide(),$("#btn-header-thumbnails").removeClass("is-active")}),$(document).on("click",".item-thumbnails",function(t){$(".book").turn("page",$(this).index()),$(".thumbnails").hide(),$("#btn-header-thumbnails").removeClass("is-active")});var hosted_enrichi=[],module={ratio:book_settings.width/book_settings.height*2,init:function(t){var e=this;document.addEventListener&&(this.el=document.getElementById(t),this.resize(),this.plugins(),window.addEventListener("resize",function(t){var n=e.resize();$(e.el).turn("size",n.width,n.height)}))},resize:function(){this.el.style.width="",this.el.style.height="";var t=this.el.clientWidth,e=Math.round(t/this.ratio),n=Math.round(.9*document.body.clientHeight);return e>n&&(e=n,t=Math.round(e*this.ratio)),this.el.style.width=t+"px",this.el.style.height=e+"px",{width:t,height:e}},plugins:function(){$(this.el).turn({gradients:!0,acceleration:!0,display:"double",duration:1e3,elevation:100,pages:book_settings.pages,when:{turning:function(t,e,n){instance.smoothZoom($(".book").width()/2,$(".book").height()/2,.1),1==e?($(".book").css("transform","translate3d(-25%, 0px, 0px)"),$(".book").css("box-shadow","none")):($(".book").css("transform","translate3d(0px, 0px, 0px)"),$(".book").css("box-shadow","0 0 20px rgba(0,0,0,0.5)"));var i=$(this);i.turn("page"),i.turn("pages");Hash.go("page/"+e).update()},turned:function(t,e,n){$(".page-wrapper").removeClass("Intheviewport");var i=$("#book").turn("page");i%2?($(".p"+i).addClass("Intheviewport"),i>1&&$(".p"+(i-1)).addClass("Intheviewport")):($(".p"+i).addClass("Intheviewport"),$(".p"+(i+1)).addClass("Intheviewport")),[i,i-1,i+1].includes(parseInt($(this).attr("id"))),$(".page-draw").droppable({accept:".chi-elm",drop:function(t,e){var n=$("#book").turn("page");if(console.log(n),[n,n-1,n+1].includes(parseInt($(this).attr("id")))){var i=$(e.helper).context.id,a=t.clientX-$(this).offset().left,o=t.clientY-$(this).offset().top;a-=20,o-=20,a/=instance.getTransform().scale,o/=instance.getTransform().scale,a=a/parseFloat($(this).css("width"))*100,o=o/parseFloat($(this).css("height"))*100,lastposX=a,lastposY=o,dropElmEnrich(i,a,o,this,$(this).attr("id"))}}}),$(".thumbnails .item-thumbnails").removeClass("active"),$(".thumbnails .item-thumbnails").eq($(".book").turn("page")).addClass("active"),$(".thumbnails .page-"+$(".book").turn("page")).parent().removeClass("current"),$(".thumbnails .page-"+e).parent().addClass("current"),$(".thumbnails").animate({scrollLeft:$(".thumbnails .item-thumbnails.active").offset().left},0),$(".input-current-page").val($(".book").turn("page")),1==e?($(".book").css("transform","translate3d(-25%, 0px, 0px)"),$(".book").css("box-shadow","none")):($(".book").css("transform","translate3d(0px, 0px, 0px)"),$(".book").css("box-shadow","0 0 20px rgba(0,0,0,0.5)"))},missing:function(t,e){for(var n=0;n<e.length;n++)addPage(e[n],$(this))}}}),document.body.className="hide-overflow"}};$(document).on("mousemove",".p1",function(t){if(!$(".p1 .page-draw").hasClass("ui-droppable")){$("#book").turn("page");$(".page-draw").droppable({accept:".chi-elm",drop:function(t,e){var n=$("#book").turn("page");if(console.log(n),[n,n-1,n+1].includes(parseInt($(this).attr("id")))){var i=$(e.helper).context.id,a=t.clientX-$(this).offset().left,o=t.clientY-$(this).offset().top;a-=20,o-=20,a/=instance.getTransform().scale,o/=instance.getTransform().scale,a=a/parseFloat($(this).css("width"))*100,o=o/parseFloat($(this).css("height"))*100,lastposX=a,lastposY=o,dropElmEnrich(i,a,o,this,$(this).attr("id"))}}})}}),$(".thumbnails").html('<div class="close-thumbnails">x</div>');for(var ith=1;ith<book_settings.pages;ith++)$(".thumbnails").append('\n <div class="item-thumbnails">\n \t<img src="thumbnail/'+ith+'.jpg"  draggable="false" width="76" height="100" class="" alt="">\n \t<p style="width:100%;text-align:center;">'+ith+"</p>\n </div>\n");async function Myinit(){var t=await getUserInfo();setUpProfile(t);var e=!0;"error"==t?e=!1:"admin"!=t.name.type&&(e=!1);hosted_enrichi=await listRowsDB();for(var n=[],i=0;i<hosted_enrichi.length;i++)console.log(e),e?n.push(hosted_enrichi[i]):hosted_enrichi[i].active&&n.push(hosted_enrichi[i]);prepareRessources(t,hosted_enrichi=n),module.init("book"),localStorage.getItem("histo_page"),location.hash.indexOf("page/")&&$(".book").turn("page",location.hash.substring(6,location.hash.length))}function setUpProfile(t){"error"==t?($(".app-icon-login").html('<svg  style="transform: translateY(3px) scale(0.9);" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><g><rect fill="none" height="24" width="24"/></g><g><path d="M11,7L9.6,8.4l2.6,2.6H2v2h10.2l-2.6,2.6L11,17l5-5L11,7z M20,19h-8v2h8c1.1,0,2-0.9,2-2V5c0-1.1-0.9-2-2-2h-8v2h8V19z"/></g></svg>'),$(".app-icon-login").attr("title","Se connecter")):"admin"==t.name.type&&($(".app-icon-login").html('<svg  style="transform: translateY(3px) scale(0.9);" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><g><path d="M0,0h24v24H0V0z" fill="none"/></g><g><path d="M17,8l-1.41,1.41L17.17,11H9v2h8.17l-1.58,1.58L17,16l4-4L17,8z M5,5h7V3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h7v-2H5V5z"/></g></svg>'),$(".app-icon-login").attr("title","Déconnexion"),$("#parent-elms-enrichi").show());$(".app-icon-login").show(),$(".app-icon-login").hide()}async function prepareRessources(t,e){var n=!0;"error"==t?n=!1:"admin"!=t.name.type&&(n=!1);hosted_enrichi=e;for(var i=[],a=0;a<hosted_enrichi.length;a++)n?i.push(hosted_enrichi[a]):hosted_enrichi[a].active&&i.push(hosted_enrichi[a]);hosted_enrichi=i;for(var o="",s=0;s<hosted_enrichi.length;s++)if(hosted_enrichi[s]){var r="#b4b4b4";hosted_enrichi[s].active&&(r="rgb(255, 102, 0)"),o+='\n<div class="item-ressource ITMRSanchor-'+hosted_enrichi[s].type+' " blank="'+hosted_enrichi[s].blank+'" w="'+hosted_enrichi[s].w+'" \nh="'+hosted_enrichi[s].h+'" top_="'+hosted_enrichi[s].top+'" \nleft_="'+hosted_enrichi[s].left+'" page="'+hosted_enrichi[s].page+'" \nshared="'+hosted_enrichi[s].active+'" \nuniqueid="'+hosted_enrichi[s].id+'" id="'+hosted_enrichi[s].id+'" \ntitle="'+unescape(atob(hosted_enrichi[s].titre))+'" url="'+hosted_enrichi[s].data+'"\n >\n\t<div class="item-activite-thumbnail">\n<div style="background:'+r+';z-index:0;" class="RSanchor RSanchor-'+hosted_enrichi[s].type+'" title="" url=""></div>\n    </div>\n<div class="item-activite-content">\n      <p class="title-activite">'+unescape(atob(hosted_enrichi[s].titre))+'</p>\n      <p class="description-activite" style="text-align: left;">\n      \t <span class="tag">page.'+hosted_enrichi[s].page+"</span>\n      </p>\n</div>\n</div>"}$("#itmes-ressources").html(o),$(".ms-options-wrap input").attr("placeholder","Chercher")}$(".thumbnails .item-thumbnails").eq($(".book").turn("page")).addClass("active"),Myinit();let topLeft={x:0,y:0},topRight={x:1,y:0},bottomLeft={x:0,y:1},bottomRight={x:1,y:1},centerCenter={x:.5,y:.5};var element=document.querySelector(".rel"),instance=panzoom(element,{transformOrigin:centerCenter,maxZoom:3,minZoom:1,bounds:!0,boundsPadding:1});let origin=instance.getTransformOrigin();async function dropElmEnrich(t,e,n,i,a){var o=getID()+(new Date).getTime();if("btn-video-enrechi"==t){var s='<div top_="'+n+'" left_="'+e+'" page="'+a+'" shared="false" uniqueid="'+o+'" id="'+o+'" style="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" class="anchor anchor-video" title="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-yt-enrechi"==t){s='<div top_="'+n+'" left_="'+e+'" \n\tpage="'+a+'" \n\tshared="false" uniqueid="'+o+'" \n\tid="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" \n\tclass="anchor anchor-yt" \n\ttitle="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-app-enrechi"==t){s='<div top_="'+n+'" left_="'+e+'" \n\tpage="'+a+'" \n\tshared="false" uniqueid="'+o+'" \n\tid="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" \n\tclass="anchor anchor-app" \n\ttitle="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-link-page-enrechi"==t){s='<div top_="'+n+'" left_="'+e+'" \n\tpage="'+a+'" \n\tshared="false" uniqueid="'+o+'" \n\tid="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" \n\tclass="anchor anchor-link-page" \n\ttitle="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-link-enrechi"==t){s='<div top_="'+n+'" left_="'+e+'" \n\tpage="'+a+'" \n\tshared="false" uniqueid="'+o+'" \n\tid="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" \n\tclass="anchor anchor-link" \n\ttitle="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-audio-enrechi"==t){s='<div top_="'+n+'" left_="'+e+'" page="'+a+'" shared="false" uniqueid="'+o+'" id="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:#b4b4b4;position:absolute;" class="anchor anchor-audio" title="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s)}if("btn-note-enrechi"==t){s='<div  key = "'+("elm-annotate-note_FR3_"+a+o)+'" id="'+o+'" \n\tstyle="top:'+n+"%;left:"+e+'%;background:rgb(255, 102, 0);position:absolute;" \n\tclass="anchor anchor-note-annotate" title="" url=""></div>';s=$(s).draggable({stop:function(t,e){var n=100*parseFloat($(this).css("left"))/parseFloat($(this).parent().css("width"))+"%",i=100*parseFloat($(this).css("top"))/parseFloat($(this).parent().css("height"))+"%";$(this).css("left",n),$(this).css("top",i),$(this).css("width","7%"),$(this).css("height","4%")}}),$(i).append(s),await localforageSetItem("elm-annotate-note_FR3_"+a+o,{id:o,top:n,left:e,data:null,page:a})}}function addPage(t,e){e.turn("pages");var n=$("<div />",{});e.turn("addPage",n,t)&&(t>1?n.html('<div class="gradient"></div><div class="loader"></div>'):n.html('<div style="box-shadow:0 0 10px rgba(0,0,0,0.5);position: absolute;top: 3px;left: 3px;width:calc( 100% - 6px); height: calc(100% - 6px);" class=" "></div><div class="loader"></div>'),loadPage(t,n))}function loadPage(t,e){var n=$("<img />");n.mousedown(function(t){t.preventDefault()}),n.load(function(){$(this).css({width:"100%",height:"100%"}),$(this).appendTo(e),e.find(".loader").remove()}),n.attr("src","pages/"+t+".jpg"),e.append('<div class="mypagecontent" style="position:absolute;top:0;left:0;width:100%;height:100%;"></div>'),loadContent(t,e)}function zoomTo(t){setTimeout(function(){$(".magazine-viewport").data().regionClicked?$(".magazine-viewport").data().regionClicked=!1:1==$(".magazine-viewport").zoom("value")?$(".magazine-viewport").zoom("zoomIn",t):$(".magazine-viewport").zoom("zoomOut")},1)}function loadRegions(t,e){$.getJSON("pages/"+t+"-regions.json").done(function(t){$.each(t,function(t,n){addRegion(n,e)})})}function addRegion(t,e){var n=$("<div />",{class:"region  "+t.class}),i=$(".magazine").turn("options"),a=i.width/2,o=i.height;n.css({top:Math.round(t.y/o*100)+"%",left:Math.round(t.x/a*100)+"%",width:Math.round(t.width/a*100)+"%",height:Math.round(t.height/o*100)+"%"}).attr("region-data",$.param(t.data||"")),n.appendTo(e)}function regionClick(t){var e=$(t.target);if(e.hasClass("region"))return $(".magazine-viewport").data().regionClicked=!0,setTimeout(function(){$(".magazine-viewport").data().regionClicked=!1},100),processRegion(e,$.trim(e.attr("class").replace("region","")))}function processRegion(t,e){switch(data=decodeParams(t.attr("region-data")),e){case"link":window.open(data.url);break;case"zoom":var n=t.offset(),i=$(".magazine-viewport").offset(),a={x:n.left-i.left,y:n.top-i.top};$(".magazine-viewport").zoom("zoomIn",a);break;case"to-page":$(".magazine").turn("page",data.page)}}function loadLargePage(t,e){var n=$("<img />");n.load(function(){var t=e.find("img");$(this).css({width:"100%",height:"100%"}),$(this).appendTo(e),t.remove()}),n.attr("src","pages/"+t+"-large.jpg")}function loadSmallPage(t,e){var n=e.find("img");n.css({width:"100%",height:"100%"}),n.unbind("load"),n.attr("src","pages/"+t+".jpg")}function isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}function disableControls(t){1==t?$(".previous-button").hide():$(".previous-button").show(),t==$(".magazine").turn("pages")?$(".next-button").hide():$(".next-button").show()}function resizeViewport(){var t=$(window).width(),e=$(window).height(),n=$(".magazine").turn("options");if($(".magazine").removeClass("animated"),$(".magazine-viewport").css({width:t,height:e}).zoom("resize"),1==$(".magazine").turn("zoom")){var i=calculateBound({width:n.width,height:n.height,boundWidth:Math.min(n.width,t),boundHeight:Math.min(n.height,e)});i.width%2!=0&&(i.width-=1),i.width==$(".magazine").width()&&i.height==$(".magazine").height()||($(".magazine").turn("size",i.width,i.height),1==$(".magazine").turn("page")&&$(".magazine").turn("peel","br"),$(".next-button").css({height:i.height,backgroundPosition:"-38px "+(i.height/2-16)+"px"}),$(".previous-button").css({height:i.height,backgroundPosition:"-4px "+(i.height/2-16)+"px"})),$(".magazine").css({top:-i.height/2,left:-i.width/2})}var a=$(".magazine").offset(),o=e-a.top-$(".magazine").height(),s=(o-$(".thumbnails > div").height())/2;s<0?$(".thumbnails").css({height:1}):($(".thumbnails").css({height:o}),$(".thumbnails > div").css({marginTop:s})),a.top<$(".made").height()?$(".made").hide():$(".made").show(),$(".magazine").addClass("animated")}function numberOfViews(t){return t.turn("pages")/2+1}function getViewNumber(t,e){return parseInt((e||t.turn("page"))/2+1,10)}function moveBar(t){Modernizr&&Modernizr.csstransforms&&$("#slider .ui-slider-handle").css({zIndex:t?-1:1e4})}function setPreview(t){var e=$(_thumbPreview.children(":first")),n=1==(1==t||t==$("#slider").slider("option","max")?1:2)?56:112;_thumbPreview.addClass("no-transition").css({width:n+15,height:88,top:-103,left:($($("#slider").children(":first")).width()-n-15)/2}),e.css({width:n,height:73}),""!==e.css("background-image")&&"none"!=e.css("background-image")||(e.css({backgroundImage:"url(pages/preview.jpg)"}),setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)),e.css({backgroundPosition:"0px -"+73*(t-1)+"px"})}function largeMagazineWidth(){return 2214}function decodeParams(t){for(var e,n=t.split("&"),i={},a=0;a<n.length;a++)e=n[a].split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return i}function calculateBound(t){var e={width:t.width,height:t.height};if(e.width>t.boundWidth||e.height>t.boundHeight){var n=e.width/e.height;t.boundWidth/n>t.boundHeight&&t.boundHeight*n<=t.boundWidth?(e.width=Math.round(t.boundHeight*n),e.height=t.boundHeight):(e.width=t.boundWidth,e.height=Math.round(t.boundWidth/n))}return e}function getUserInfo(){return new Promise(async t=>{fetch("/getUserName").then(t=>t.json()).then(e=>{t(e)}).catch(e=>{t("error")})})}function listRowsDB(){return new Promise(async t=>{fetch("/enrichi.json").then(t=>t.json()).then(e=>{t(e)}).catch(e=>{t("error")})})}function getID(){return"_"+Math.random().toString(36).substr(2,9)}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function saveElmEnrichi(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/insertRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}function percentwidth(t){var e=t.offsetParent||t;return(t.offsetWidth/e.offsetWidth*100).toFixed(2)+"%"}function removeRowDB(t){return t=JSON.stringify(t),new Promise(async e=>{fetch("/removeRowDB?obj="+t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{e("error")})})}instance.setTransformOrigin(bottomRight),instance.setTransformOrigin(null),instance.setTransformOrigin(centerCenter),$(document).on("dblclick",".page-wrapper",function(t){}),$(".chi-elm").draggable({helper:"clone",start:function(t,e){var n=$(e.helper).context;$(e.helper).css("opacity",0);var i=$(n).clone(!0);$("#helper-clones").html(i.removeClass("ui-draggable ui-draggable-handle ui-draggable-dragging").attr("id","showmzhelper").css("position","absolute").css("zoom","1").css("opacity","1"))},drag:function(t,e){$("#showmzhelper").css("top",t.clientY-20+"px"),$("#showmzhelper").css("left",t.clientX-20+"px")},stop:function(t,e){$("#showmzhelper").remove()}}),$(document).on("click",".item-ressource",function(t){$("#mesressources").hide()}),$(document).on("click",".anchor",async function(t){$(".edit-video-book-reader").hide(),$(".edit-audio-book-reader").hide(),$(".edit-yt-book-reader").hide(),$(".edit-app-book-reader").hide(),$(".edit-link-page-book-reader").hide(),$(".edit-link-book-reader").hide();var e=await getUserInfo(),n=!0;"error"==e?n=!1:"admin"!=e.name.type&&(n=!1);n&&($(".edit-video-book-reader").show(),$(".edit-audio-book-reader").show(),$(".edit-yt-book-reader").show(),$(".edit-app-book-reader").show(),$(".edit-link-page-book-reader").show(),$(".edit-link-book-reader").show())}),$(document).on("mousedown touchstart",".anchor",function(t){instance.pause()}),$(document).on("mouseup touchend",".anchor",function(t){instance.resume()}),$(document).on("mousemove touchmove",".anchor",function(t){$(this).hasClass("ui-draggable")||$(this).draggable({drag:function(t,e){var n=Math.round(e.position.top/instance.getTransform().scale),i=Math.round(e.position.left/instance.getTransform().scale);e.position={top:n,left:i}},stop:function(t,e){var n=parseFloat($(this).css("left"))*instance.getTransform().scale/($(this).parent().width()*instance.getTransform().scale)*100,i=parseFloat($(this).css("top"))*instance.getTransform().scale/($(this).parent().parent().height()*instance.getTransform().scale)*100;n+="%",i+="%",$(this).css("left",n),$(this).css("top",i),$(this).attr("top_",i),$(this).attr("left_",n),$(this).css("width","7%"),$(this).css("height","4%")}})}),$(document).on("click",".btn-modal-delete-video",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove();await removeRowDB({id:t})}),$(document).on("click",".btn-modal-save-video",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-video-url").val();n=btoa(n);var i=$(this).parent().parent().find(".input-video-titre").val();i=btoa(i);var a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=$(this).parent().parent().find(".blank").is(":checked"),d=($(".video-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),h=($(".video-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),c=await saveElmEnrichi({id:e,type:"video",data:n,titre:i,top:a,left:o,page:s,active:r,w:d,h:h,blank:l});if($(this).next().next().show(),"error"!=c){var p=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".video-book-reader[uniqueid="+p+"]").remove(),$("#"+p).attr("title",atob(i)),$("#"+p).attr("url",n),$("#"+p).attr("w",d),$("#"+p).attr("h",h),$("#"+p).attr("blank",l),$("#"+p).attr("shared",r),1==r?$("#"+p).css("background","#ff6600"):$("#"+p).css("background","#b4b4b4")}else alert("Erreur de sauvegarde!"),$(this).parent().parent().parent().remove(),$(".video-book-reader[uniqueid="+p+"]").remove()}),$(document).on("click",".edit-video-book-reader",function(){var t=$(this).parent().parent().find(".title-header-book").html(),e=$(this).attr("url");e=atob(e);var n=getID(),i=$(this).parent().parent().attr("uniqueid"),a="";"true"==$(this).parent().parent().attr("shared")&&(a="checked");$(this).parent().parent().attr("blank"),e||(e=""),$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">Video:</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">URL</label>\n      <div class="control  ">\n        <input class="input-video-url input is-" type="text" placeholder=" " value="" id="'+n+'" >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n     <div class="field">\n      <label class="label"  style="font-size: 14px;">Titre</label>\n      <div class="control ">\n        <input class="input-video-titre input is-" type="text" placeholder=" " value="'+t+'">\n      </div>\n      <p class="help is-danger help-input-titre" style="display:none;">....</p>\n    </div>\n\n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+a+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n\n  \n\n\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+i+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-video"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-video" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'),$("#"+n).val(e)}),$(document).on("click",".anchor-video,.ITMRSanchor-video",function(t){var e=getID(),n=$(this).attr("title"),i=$(this).attr("w"),a=$(this).attr("h"),o=$(this).attr("url"),s=$(this).attr("shared"),r=$(this).attr("blank");atob(o).includes("youtube")&&atob(o),$("body").append('\n<div blank = "'+r+'" id="'+e+'" shared ="'+s+'" uniqueid \n= "'+$(this).attr("uniqueid")+'"  class="video-book-reader"\n style="position: absolute;height:'+a+"%;width:"+i+'%;">\n<div class="header-video-book-reader ">\n    <p class="title-header-book">'+n+'</p>\n    <div class="close-video-book-reader" style="" onclick="$(this).parent().parent().remove();">\n     <svg style="transform: translate(-7px, 2px);" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>  \n    </div>\n    <div  url="'+o+'" class="edit-video-book-reader" style="display:non;" >\n     <svg style="transform: translate(-7px, -1px);zoom:0.8;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"></path></svg>   \n    </div>\n    <div class="delete-video-book-reader" style="display:none;" >\n      <svg  style="transform: translate(-7px, -1px);zoom:0.8;"xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>\n    </div>\n</div> \n<video  controls="" style="background:black;" >\n  <source  src="'+atob(o)+'" type="video/mp4">\n      Your browser does not support the video tag.\n</video>\n</div>\x3c!--End detail-watch-video--\x3e '),$("#"+e).attr("ww",i),$("#"+e).attr("hh",a),$("#"+e).draggable({handle:".header-video-book-reader",start:function(t){$(this).hasClass("mmargin")||($(this).addClass("mmargin"),$(this).css("transform","none"),$(this).css("margin-left",$("#"+e).offset().left/$(document).width()*100+"%"))},stop:function(t){$(this).css("width",$(this).attr("ww")+"%"),$(this).css("height",$(this).attr("hh")+"%")}}).resizable(),$("#"+e).css("position","absolute"),$("#"+e).find("iframe").attr("src",atob(o))}),$(document).on("click",".btn-modal-delete-audio",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");console.log(t),$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove(),console.log("delete from server!");var e=await removeRowDB({id:t});console.log(e)}),$(document).on("click",".btn-modal-save-audio",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-audio-url").val();n=btoa(escape(n));var i=$(this).parent().parent().find(".input-audio-titre").val();i=btoa(escape(i));var a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=$(this).parent().parent().find(".blank").is(":checked");console.log(l);var d=($(".audio-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),h=($(".audio-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),c=await saveElmEnrichi({id:e,type:"audio",data:n,titre:i,top:a,left:o,page:s,active:r,w:d,h:h,blank:l});if($(this).next().next().show(),"error"!=c){var p=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".audio-book-reader[uniqueid="+p+"]").remove(),$("#"+p).attr("title",unescape(atob(i))),console.log($("#"+p)),$("#"+p).attr("url",n),$("#"+p).attr("w",d),$("#"+p).attr("h",h),$("#"+p).attr("blank",l),$("#"+p).attr("shared",r),1==r?$("#"+p+".anchor-audio").css("background","#ff6600"):$("#"+p+".anchor-audio").css("background","#b4b4b4")}else alert("Erreur de sauvegarde!"),$(this).parent().parent().parent().remove(),$(".audio-book-reader[uniqueid="+p+"]").remove();prepareRessources()}),$(document).on("click",".edit-audio-book-reader",function(){var t=$(this).parent().parent().find(".title-header-book").html(),e=$(this).attr("url");e=unescape(atob(e));var n=getID(),i=$(this).parent().parent().attr("uniqueid"),a=$(this).parent().parent().attr("shared"),o=$(this).parent().parent().attr("blank");console.log(o);var s="";"true"==a&&(s="checked");e||(e=""),$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">audio:</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">URL</label>\n      <div class="control  ">\n        <input class="input-audio-url input is-" type="text" placeholder=" " value="" id="'+n+'" >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n     <div class="field">\n      <label class="label"  style="font-size: 14px;">Titre</label>\n      <div class="control ">\n        <input class="input-audio-titre input is-" type="text" placeholder=" " value="'+t+'">\n      </div>\n      <p class="help is-danger help-input-titre" style="display:none;">....</p>\n    </div>\n\n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+s+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n\n  \n\n\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+i+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-audio"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-audio" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'),$("#"+n).val(e)}),$(document).on("click",".anchor-audio,.ITMRSanchor-audio",function(t){var e=getID(),n=$(this).attr("title"),i=$(this).attr("w"),a=$(this).attr("h"),o=$(this).attr("url"),s=$(this).attr("shared"),r=$(this).attr("blank");unescape(atob(o)).includes("youtube")&&unescape(atob(o)),$("body").append('\n<div blank = "'+r+'" id="'+e+'" shared ="'+s+'" uniqueid \n= "'+$(this).attr("uniqueid")+'"  class="audio-book-reader"\n style="position: absolute;height:'+a+"%;width:"+i+'%;">\n<div class="header-audio-book-reader ">\n    <p class="title-header-book">'+n+'</p>\n    <div class="close-audio-book-reader" style="" onclick="$(this).parent().parent().remove();">\n     <svg style="transform: translate(-7px, 2px);" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>  \n    </div>\n    <div  url="'+o+'" class="edit-audio-book-reader" style="display:non;" >\n     <svg style="transform: translate(-7px, -1px);zoom:0.8;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"></path></svg>   \n    </div>\n    <div class="delete-audio-book-reader" style="display:none;" >\n      <svg  style="transform: translate(-7px, -1px);zoom:0.8;"xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>\n    </div>\n</div> \n<audio style="height: 45px;" controls="" >\n  <source  src="'+unescape(atob(o))+'" type="audio/mp4">\n      Your browser does not support the audio tag.\n</audio>\n</div>\x3c!--End detail-watch-audio--\x3e '),$("#"+e).attr("ww",i),$("#"+e).attr("hh",a),$("#"+e).draggable({handle:".header-audio-book-reader",start:function(t){$(this).hasClass("mmargin")||($(this).addClass("mmargin"),$(this).css("transform","none"),$(this).css("margin-left",$("#"+e).offset().left/$(document).width()*100+"%"))},stop:function(t){$(this).css("width",$(this).attr("ww")+"%"),$(this).css("height",$(this).attr("hh")+"%")}}).resizable(),$("#"+e).css("position","absolute"),$("#"+e).find("iframe").attr("src",unescape(atob(o)))}),$(document).on("click",".btn-modal-delete-yt",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");console.log(t),$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove(),console.log("delete from server!");var e=await removeRowDB({id:t});console.log(e)}),$(document).on("click",".btn-modal-save-yt",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-yt-url").val();n=btoa(n);var i=$(this).parent().parent().find(".input-yt-titre").val();i=btoa(i);var a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=($(".yt-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),d=($(".yt-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),h=await saveElmEnrichi({id:e,type:"yt",data:n,titre:i,top:a,left:o,page:s,active:r,w:l,h:d});if($(this).next().next().show(),"error"!=h){var c=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".yt-book-reader[uniqueid="+c+"]").remove(),console.log(r),$("#"+c).attr("title",atob(i)),$("#"+c).attr("url",n),$("#"+c).attr("w",l),$("#"+c).attr("h",d),$("#"+c).attr("shared",r),1==r?$("#"+c).css("background","#ff6600"):$("#"+c).css("background","#b4b4b4")}}),$(document).on("click",".edit-yt-book-reader",function(){var t=$(this).parent().parent().find(".title-header-book").html(),e=$(this).attr("url");e=atob(e);var n=getID(),i=$(this).parent().parent().attr("uniqueid"),a="";"true"==$(this).parent().parent().attr("shared")&&(a="checked"),e||(e=""),$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">Information video youtube</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">Code integration youtube</label>\n      <div class="control  ">\n        <input class="input-yt-url input is-" type="text" placeholder=" " value="" id="'+n+'" >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n     <div class="field">\n      <label class="label"  style="font-size: 14px;">Titre</label>\n      <div class="control ">\n        <input class="input-yt-titre input is-" type="text" placeholder=" " value="'+t+'">\n      </div>\n      <p class="help is-danger help-input-titre" style="display:none;">....</p>\n    </div>\n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+a+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+i+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-yt"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-yt" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'),$("#"+n).val(e)}),$(document).on("click",".anchor-yt,.ITMRSanchor-yt",function(t){var e=getID(),n=$(this).attr("title"),i=$(this).attr("w"),a=$(this).attr("h"),o=$(this).attr("url"),s=$(this).attr("shared"),r='<div style="width:560px;height:315px;"></div>';console.log(o),atob(o).includes("youtube")&&(r=atob(o)),$("body").append('\n<div  id="'+e+'" shared ="'+s+'" uniqueid \n= "'+$(this).attr("uniqueid")+'"  class="yt-book-reader" \nstyle="position: absolute;height:'+a+"%;width:"+i+'%;">\n<div class="header-yt-book-reader ">\n    <p class="title-header-book">'+n+'</p>\n    <div class="close-yt-book-reader" style="" onclick="$(this).parent().parent().remove();">\n     <svg style="transform: translate(-7px, 2px);" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>  \n    </div>\n    <div  url="'+o+'" class="edit-yt-book-reader" style="display:non;" >\n     <svg style="transform: translate(-7px, -1px);zoom:0.8;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"></path></svg>   \n    </div>\n    <div class="delete-yt-book-reader" style="display:none;" >\n      <svg  style="transform: translate(-7px, -1px);zoom:0.8;"xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>\n    </div>\n</div> \n'+r+"\n</div>\x3c!--End detail-watch-yt--\x3e "),$("#"+e).attr("ww",i),$("#"+e).attr("hh",a),$("#"+e).draggable({handle:".header-yt-book-reader",start:function(t){$(this).hasClass("mmargin")||($(this).addClass("mmargin"),$(this).css("transform","none"),$(this).css("margin-left",$("#"+e).offset().left/$(document).width()*100+"%"))},stop:function(t){$(this).css("width",$(this).attr("ww")+"%"),$(this).css("height",$(this).attr("hh")+"%")}}).resizable(),$("#"+e).css("position","absolute")}),$(document).on("click",".btn-modal-delete-app",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");console.log(t),$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove(),console.log("delete from server!");var e=await removeRowDB({id:t});console.log(e)}),$(document).on("click",".btn-modal-save-app",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-app-url").val();n=btoa(n);var i=$(this).parent().parent().find(".input-app-titre").val();i=btoa(i);var a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=$(this).parent().parent().find(".blank").is(":checked");console.log(l);var d=($(".app-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),h=($(".app-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),c=await saveElmEnrichi({id:e,type:"app",data:n,titre:i,top:a,left:o,page:s,active:r,w:d,h:h,blank:l});if($(this).next().next().show(),"error"!=c){var p=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".app-book-reader[uniqueid="+p+"]").remove(),console.log(r),$("#"+p).attr("title",atob(i)),console.log($("#"+p)),$("#"+p).attr("url",n),$("#"+p).attr("w",d),$("#"+p).attr("h",h),$("#"+p).attr("blank",l),$("#"+p).attr("shared",r),1==r?$("#"+p).css("background","#ff6600"):$("#"+p).css("background","#b4b4b4"),console.log($("#"+p))}else alert("Erreur de sauvegarde!"),$(this).parent().parent().parent().remove(),$(".app-book-reader[uniqueid="+p+"]").remove()}),$(document).on("click",".edit-app-book-reader",function(){var t=$(this).parent().parent().find(".title-header-book").html(),e=$(this).attr("url");e=atob(e);var n=getID(),i=$(this).parent().parent().attr("uniqueid"),a=$(this).parent().parent().attr("shared"),o=$(this).parent().parent().attr("blank");console.log(o);var s="";"true"==a&&(s="checked");var r="";"true"==o&&(r="checked"),e||(e=""),$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">Information applet</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">URL</label>\n      <div class="control  ">\n        <input class="input-app-url input is-" type="text" placeholder=" " value="" id="'+n+'" >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n     <div class="field">\n      <label class="label"  style="font-size: 14px;">Titre</label>\n      <div class="control ">\n        <input class="input-app-titre input is-" type="text" placeholder=" " value="'+t+'">\n      </div>\n      <p class="help is-danger help-input-titre" style="display:none;">....</p>\n    </div>\n\n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+s+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n\n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+r+' style="transform: translateY(4px);zoom: 2;" class="checkbox blank " type="checkbox"> Ouvrir nouvelle page. \n    </label>\n\n\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+i+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-app"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-app" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'),$("#"+n).val(e)}),$(document).on("click",".anchor-app,.ITMRSanchor-app",function(t){var e=getID(),n=$(this).attr("title");console.log($(this));var i=$(this).attr("w"),a=$(this).attr("h"),o=$(this).attr("url"),s=$(this).attr("shared"),r=$(this).attr("blank"),l='<iframe style="background:white;" src="" \ntitle="" frameborder="0" \nallow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n allowfullscreen></iframe>';atob(o).includes("youtube")&&(l=atob(o)),$("body").append('\n<div blank = "'+r+'" id="'+e+'" shared ="'+s+'" uniqueid \n= "'+$(this).attr("uniqueid")+'"  class="app-book-reader"\n style="position: absolute;height:'+a+"%;width:"+i+'%;">\n<div class="header-app-book-reader ">\n    <p class="title-header-book">'+n+'</p>\n    <div class="close-app-book-reader" style="" onclick="$(this).parent().parent().remove();">\n     <svg style="transform: translate(-7px, 2px);" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>  \n    </div>\n    <div  url="'+o+'" class="edit-app-book-reader" style="display:non;" >\n     <svg style="transform: translate(-7px, -1px);zoom:0.8;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"></path></svg>   \n    </div>\n    <div class="delete-app-book-reader" style="display:none;" >\n      <svg  style="transform: translate(-7px, -1px);zoom:0.8;"xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>\n    </div>\n</div> \n'+l+"\n</div>\x3c!--End detail-watch-app--\x3e "),$("#"+e).draggable({handle:".header-app-book-reader",start:function(t){$(this).attr("ww",$(this).width()),$(this).attr("hh",$(this).height()),$(this).hasClass("mmargin")||($(this).addClass("mmargin"),$(this).css("transform","none"),$(this).css("margin-left",$("#"+e).offset().left/$(document).width()*100+"%"))},stop:function(t){$(this).css("width",$(this).attr("ww")+"px"),$(this).css("height",$(this).attr("hh")+"px")}}).resizable(),$("#"+e).css("position","absolute"),$("#"+e).find("iframe").attr("src",atob(o))}),$(document).on("click",".btn-modal-delete-link-page",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");console.log(t),$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove(),console.log("delete from server!");var e=await removeRowDB({id:t});console.log(e)}),$(document).on("click",".btn-modal-save-link-page",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-link-page-url").val(),i="Aller a la page "+n,a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=($(".link-page-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),d=($(".link-page-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),h=await saveElmEnrichi({id:e,type:"link-page",data:n,titre:btoa(i),top:a,left:o,page:s,active:r,w:l,h:d});if($(this).next().next().show(),"error"!=h){var c=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".link-page-book-reader[uniqueid="+c+"]").remove(),console.log(r),$("#"+c).attr("title",i),console.log($("#"+c)),$("#"+c).attr("url",n),$("#"+c).attr("w",l),$("#"+c).attr("h",d),$("#"+c).attr("shared",r),1==r?$("#"+c).css("background","#ff6600"):$("#"+c).css("background","#b4b4b4")}else alert("Erreur de sauvegarde!"),$(this).parent().parent().parent().remove(),$(".link-page-book-reader[uniqueid="+c+"]").remove()}),$(document).on("click",".anchor-link-page,.ITMRSanchor-link-page",async function(t){var e=await getUserInfo(),n=!0;"error"==e?n=!1:"admin"!=e.name.type&&(n=!1);var i=$(this).attr("id"),a=(getID(),$(this).attr("title"),$(this).attr("w"),$(this).attr("h"),$(this).attr("url")),o=$(this).attr("shared");$(this).attr("blank");console.log($(this));var s="";"true"==o&&(s="checked"),n?$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">Aller à la page:</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">Numero page</label>\n      <div class="control  ">\n        <input class="input-link-page-url input is-" type="number" placeholder=" " value="'+a+'"  >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n \n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+s+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+i+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-link-page"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-link-page" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'):$(".book").turn("page",a)}),$(document).on("click",".btn-modal-delete-link",async function(){$(this).next().next().show();var t=$(this).parent().attr("uniqueid");console.log(t),$(this).parent().parent().parent().remove(),$("[uniqueid="+t+"]").remove(),$("#"+t).remove(),console.log("delete from server!");var e=await removeRowDB({id:t});console.log(e)}),$(document).on("click",".btn-modal-save-link",async function(t){var e=$(this).parent().attr("uniqueid"),n=$(this).parent().parent().find(".input-link-url").val(),i="Aller a la page "+n,a=$("#"+e).attr("top_").substring(0,10),o=$("#"+e).attr("left_").substring(0,10),s=$("#"+e).attr("page"),r=$(this).parent().parent().find(".partage_public").is(":checked"),l=($(".link-book-reader[uniqueid='"+e+"']").width()/$(document).width()*100).toFixed(2),d=($(".link-book-reader[uniqueid='"+e+"']").height()/$(document).height()*100).toFixed(2),h=await saveElmEnrichi({id:e,type:"link",data:n,titre:btoa(i),top:a,left:o,page:s,active:r,w:l,h:d});if($(this).next().next().show(),"error"!=h){var c=$(this).parent().attr("uniqueid");$(this).parent().parent().parent().remove(),$(".link-book-reader[uniqueid="+c+"]").remove(),console.log(r),$("#"+c).attr("title",i),console.log($("#"+c)),$("#"+c).attr("url",n),$("#"+c).attr("w",l),$("#"+c).attr("h",d),$("#"+c).attr("shared",r),1==r?$("#"+c).css("background","#ff6600"):$("#"+c).css("background","#b4b4b4")}else alert("Erreur de sauvegarde!"),$(this).parent().parent().parent().remove(),$(".link-book-reader[uniqueid="+c+"]").remove()}),$(document).on("click",".anchor-link,.ITMRSanchor-link",async function(t){var e=$(this).attr("id"),n=(getID(),$(this).attr("title"),$(this).attr("w"),$(this).attr("h"),$(this).attr("url")),i=$(this).attr("shared");$(this).attr("blank");console.log($(this));var a="";"true"==i&&(a="checked");var o=await getUserInfo(),s=!0;"error"==o?s=!1:"admin"!=o.name.type&&(s=!1);s?$("body").append('<div class="modal is-activ is-active">\n  <div class="modal-background"></div>\n  <div class="modal-card">\n    <header class="modal-card-head" style="height:30px;">\n      <p class="modal-card-title" style="font-size:16px;">Lien web:</p>\n      <button class="delete" aria-label="close" onclick="$(this).parent().parent().parent().removeClass(\'is-active\');"></button>\n    </header>\n    <section class="modal-card-body" style="position:relative;">\n     <div class="field">\n      <label class="label" style="font-size: 14px;">url</label>\n      <div class="control  ">\n        <input class="input-link-url input is-" type="text" placeholder=" " value="'+n+'"  >\n      </div>\n      <p class="help is-danger help-input-name-student" style="display:none;">....</p>\n    </div>\n \n    <label style="text-align: ;   font-size: 14px;" class="label is-">\n      <input '+a+' style="transform: translateY(4px);zoom: 2;" class="checkbox partage_public " type="checkbox"> Partagé avec tout le monde. \n    </label>\n</section>  \x3c!-- section ... --\x3e\n    <footer class="modal-card-foot" uniqueid = "'+e+'"  >\n      <button  style="position:absolute;top:10px;right: 139px;" class="button is-light   btn-modal-delete-link"  >Supprimer</button>\n      <button  style="position:absolute;top:10px;right:10px;" class="button is-success btn-modal-save-link" >Enregistrer</button>\n      <br> \n       <div class="loaderd" style="display:none;position: absolute;top: 0;left: 0;height: 100%;background: white;width: 100%;">\n          <button class="button is-warning is-loading" style="    width: 100%;background-color: transparent;margin-top: 20px;">Loading</button>\n        </div>\n    </footer>\n  </div>\n</div>'):window.open(n)}),$(".header-btn-edit").show(),$(document).on("click",".close-login-iframe",function(t){$("#parent-iframe").hide()}),$(document).on("click",".app-icon-login",function(t){console.log("fff"),window.location.href="/logout"});