<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="css/rester.css"> 

    <script type="text/javascript" src="libjs/jquery.js"></script>
    <script type="text/javascript" src="libjs/jquery-ui.js"></script>
    <script type="text/javascript" src="libjs/jquery.ui.touch-punch.js"></script>
    <script type="text/javascript" src="libjs/screenshot-dev.js"></script>
    <script type="text/javascript" src="libjs/firebase.js"></script>


</head>

<body>

<div id="b1" class="elmdraggable" style="position:absolute;top:15%;left:10%;width:30%;height:18%;background:#9F927D"></div>
<div id="b2" class="elmdraggable" style="position:absolute;top:15%;left:50%;width:30%;height:20%;border-radius:50%;background:#900f7D"></div>
<div id="b3" class="elmdraggable triangle-up" style="position:absolute;top:50%;left:20%;"><div></div></div>

<script>


//setTimeout(sendChange, 500);
$(".elmdraggable").draggable({
    containment: 'parent',
     stop: function(event, ui){
                var parentOffset = $("body").offset();
                var relX =ui.offset.left   - parentOffset.left;
                var relY =ui.offset.top - parentOffset.top;
                relX = Math.floor(((relX*100)/$("body").width()))
                relY = Math.floor(((relY*100)/$("body").height()))
                var obTosn = {
                    id   : ui.helper.attr("id"),
                    post : relY,
                    posl : relX
                }
                firebase.push(obTosn);

     }
});






var channel = location.href.replace(/\/|:|#|%|\.|\[|\]/g, '');
var firebase = new Firebase('https://webrtc.firebaseIO.com/' + channel);
//var image = document.querySelector('img');
firebase.on("child_added", function (data) {
    //$("body").html(data.val())
    // console.log("in on firebase");
    //console.log(data.val());
    var elm=data.val();
    $("#"+elm.id).css("top",elm.post+"%");
    $("#"+elm.id).css("left",elm.posl+"%");
    console.log(elm.id)
    console.log(elm.post)   
    console.log(elm.posl)

});
firebase.onDisconnect().remove();

function sendChange(){
firebase.push($("body").html());
}//end sendChange()






$(document).on("click","#sendmessage",function () {
alert("hey sendmessage btn clicked!");
firebase.push("fares in coming message send from firebase");
})



</script>






<style>
body,html{
width:100%;
height:100%;
overflow: hidden;
}
.triangle-up {
    width: 25%;
    height: 0;
    padding-left:25%;
    padding-bottom: 25%;
    overflow: hidden;
}
.triangle-up div {
    width: 0;
    height: 0;
    margin-left:-500px;
    border-left: 500px solid transparent;
    border-right: 500px solid transparent;
    border-bottom: 500px solid #4679BD;
}
</style>

    </body>
</html>